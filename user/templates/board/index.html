{% extends 'base.html' %}
{% load static %}
{% block content %}

    <body class="app">
    <header class="app-header fixed-top">
        {% include 'board/navbar.html' %}
        {% include 'board/sidebar.html' %}
    </header>
    <!--//app-header-->

    <div class="app-wrapper">

        <div class="app-content pt-3 p-md-3 p-lg-4">
            {% include 'alerts.html' %}
            <div class="container-xl">


                <h1 class="app-page-title">Overview</h1>

                <div class="app-card alert alert-dismissible shadow-sm mb-4 border-left-decoration" role="alert">
                    <div class="inner">
                        <div class="app-card-body p-3 p-lg-4">
                            <h3 class="mb-3">Welcome, Admin!</h3>
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                        <!--//app-card-body-->

                    </div>
                    <!--//inner-->
                </div>
                <!--//app-card-->

                <div class="row g-4 mb-4">
                    <div class="col-6 col-lg-3">
                        <div class="app-card app-card-stat shadow-sm h-100">
                            <div class="app-card-body p-3 p-lg-4">
                                <h4 class="stats-type mb-1">Total Employees</h4>
                                <div class="stats-figure">628</div>
                            </div>
                            <!--//app-card-body-->
                            <a class="app-card-link-mask" href="#"></a>
                        </div>
                        <!--//app-card-->
                    </div>
                    <!--//col-->

                    <div class="col-6 col-lg-3">
                        <div class="app-card app-card-stat shadow-sm h-100">
                            <div class="app-card-body p-3 p-lg-4">
                                <h4 class="stats-type mb-1">Huduma centres</h4>
                                <div class="stats-figure">52</div>
                            </div>
                            <!--//app-card-body-->
                            <a class="app-card-link-mask" href="#"></a>
                        </div>
                        <!--//app-card-->
                    </div>
                    <!--//col-->
                    <div class="col-6 col-lg-3">
                        <div class="app-card app-card-stat shadow-sm h-100">
                            <div class="app-card-body p-3 p-lg-4">
                                <h4 class="stats-type mb-1">Employees on Leave</h4>
                                <div class="stats-figure">23</div>

                            </div>
                            <!--//app-card-body-->
                            <a class="app-card-link-mask" href="#"></a>
                        </div>
                        <!--//app-card-->
                    </div>
                    <!--//col-->
                    <div class="col-6 col-lg-3">
                        <div class="app-card app-card-stat shadow-sm h-100">
                            <div class="app-card-body p-3 p-lg-4">
                                <h4 class="stats-type mb-1">Leaves</h4>
                                <div class="stats-figure">6</div>

                            </div>
                            <!--//app-card-body-->
                            <a class="app-card-link-mask" href="#"></a>
                        </div>
                        <!--//app-card-->
                    </div>
                    <!--//col-->
                </div>
                <!--//row-->

                <div class="container-xl">

                    <div class="row g-3 mb-4 align-items-center justify-content-between">
                        <div class="col-auto">
                            <h1 class="app-page-title mb-0">Leaves</h1>
                        </div>
                        <div class="col-auto">
                            <div class="page-utilities">
                                <div class="row g-2 justify-content-start justify-content-md-end align-items-center">
                                    <div class="col-auto">
                                        <form class="table-search-form row gx-1 align-items-center">
                                            <div class="col-auto">
                                                <input type="text" id="search-orders" name="searchorders"
                                                       class="form-control search-orders" placeholder="Search">
                                            </div>
                                            <div class="col-auto">
                                                <button type="submit" class="btn app-btn-secondary">Search</button>
                                            </div>
                                        </form>

                                    </div>
                                    <!--//col-->
                                    <div class="col-auto">

                                        <select class="form-select w-auto">
                                            <option selected value="option-1">All</option>
                                            <option value="option-2">This week</option>
                                            <option value="option-3">This month</option>
                                            <option value="option-4">Last 3 months</option>

                                        </select>
                                    </div>
                                    <div class="col-auto">
                                        <a class="btn app-btn-secondary" href="#">
                                            <svg width="1em" height="1em" viewBox="0 0 16 16"
                                                 class="bi bi-download me-1" fill="currentColor"
                                                 xmlns="http://www.w3.org/2000/svg">
                                                <path fill-rule="evenodd"
                                                      d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                                                <path fill-rule="evenodd"
                                                      d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/>
                                            </svg>
                                            Download CSV
                                        </a>
                                    </div>
                                </div>
                                <!--//row-->
                            </div>
                            <!--//table-utilities-->
                        </div>
                        <!--//col-auto-->
                    </div>
                    <!--//row-->


                    <nav id="orders-table-tab"
                         class="orders-table-tab app-nav-tabs nav shadow-sm flex-column flex-sm-row mb-4">
                        <a class="flex-sm-fill text-sm-center nav-link active" id="orders-pending-tab"
                           data-bs-toggle="tab" href="#orders-pending" role="tab" aria-controls="orders-pending"
                           aria-selected="false">Pending</a>
                        <a class="flex-sm-fill text-sm-center nav-link" id="orders-paid-tab" data-bs-toggle="tab"
                           href="#orders-paid" role="tab" aria-controls="orders-paid"
                           aria-selected="false">Approved</a>
                        <a class="flex-sm-fill text-sm-center nav-link" id="orders-cancelled-tab" data-bs-toggle="tab"
                           href="#orders-cancelled" role="tab" aria-controls="orders-cancelled"
                           aria-selected="false">Cancelled</a>
                        <a class="flex-sm-fill text-sm-center nav-link" id="orders-all-tab" data-bs-toggle="tab"
                           href="#orders-all" role="tab" aria-controls="orders-all" aria-selected="true">All</a>

                    </nav>


                    <div class="tab-content" id="orders-table-tab-content">
                        <div class="tab-pane fade show active" id="orders-pending" role="tabpanel"
                             aria-labelledby="orders-pending-tab">
                            <div class="app-card app-card-orders-table mb-5">
                                <div class="app-card-body">
                                    <div class="table-responsive">
                                        <table class="table mb-0 text-left">
                                            <thead>
                                            <tr>
                                                <th class="cell">s/no</th>
                                                <th class="cell">Emp/Name</th>
                                                <th class="cell">Department</th>
                                                <th class="cell">Apply/Date</th>
                                                <th class="cell">Status</th>
                                                <th class="cell">Days Applied</th>
                                                <th class="cell"></th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% if pending %}
                                                {% for p in pending %}
                                                    <tr>
                                                        <td class="cell">{{ forloop.counter }}</td>
                                                        <td class="cell"><span class="truncate">{{ p.employee }}</span>
                                                        </td>
                                                        <td class="cell">{{ p.employee.designation }}</td>
                                                        <td class="cell"><span
                                                                class="cell-data">{{ p.posting_date }}</span>
                                                        </td>
                                                        <td class="cell"><span
                                                                class="badge bg-warning">{{ p.status }}</span></td>
                                                        <td class="cell">{{ p.no_of_days }}</td>
                                                        <td class="cell">
                                                            <a class="btn-sm app-btn-secondary" data-id="{{p.id}}"
                                                            data-admin-remarks="{{ p.admin_remarks|default:'' }}"
                                                               data-from-date="{{ p.from_date }}"
                                                               data-to-date="{{ p.to_date }}"
                                                               data-date-applied="{{ p.posting_date }}"
                                                               data-status="{{ p.status }}"
                                                               data-employee="{{ p.employee }}"
                                                            data-bs-toggle="modal" data-bs-target="#staticBackdrop" href="#">View</a>
                                                        </td>


                                                    </tr>
                                                {% endfor %}
                                            {% else %}
                                                <tr>
                                                    <td colspan="8">No leave applications found.</td>
                                                </tr>
                                            {% endif %}
                                            </tbody>
                                        </table>
                                    </div>
                                    <!--//table-responsive-->
                                </div>
                                <!--//app-card-body-->
                            </div>
                            <!--//app-card-->
                        </div>
                        <!--//tab-pane-->


                        <div class="tab-pane fade" id="orders-all" role="tabpanel" aria-labelledby="orders-all-tab">
                            <div class="app-card app-card-orders-table shadow-sm mb-5">
                                <div class="app-card-body">
                                    <div class="table-responsive">
                                        <table class="table app-table-hover mb-0 text-left">
                                            <thead>
                                            <tr>
                                                <th class="cell">s/no</th>
                                                <th class="cell">Emp/Name</th>
                                                <th class="cell">Department</th>
                                                <th class="cell">Apply/Date</th>
                                                <th class="cell">Status</th>
                                                <th class="cell">Days applied</th>

                                                <th class="cell">Action</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% if applications %}
                                                {% for a in applications %}
                                                    <tr>
                                                        <td class="cell">{{ forloop.counter }}</td>
                                                        <td class="cell"><span class="truncate">{{ a.employee }}</span>
                                                        </td>
                                                        <td class="cell">{{ a.employee.designation }}</td>
                                                        <td class="cell"><span>{{ a.posting_date }}</span></td>
                                                        <td class="cell">
                                                            <span class="badge 
                                                            {% if a.status == 'Approved' %}
                                                            bg-success
                                                            {% elif a.status == 'Rejected' %}
                                                            bg-danger
                                                            {% elif a.status == 'Pending' %}
                                                            bg-warning
                                                            {% elif a.status == 'Cancelled' %}
                                                            bg-secondary
                                                            {% else %}
                                                            bg-light
                                                            {% endif %}
                                                            ">
                                                            {{ a.status }}
                                                            </span>
                                                        </td>
                                                     <td class="cell">{{ a.no_of_days }}</td>


                                                         <td class="cell">
                                                            <a class="btn-sm app-btn-secondary" data-id="{{a.id}}"
                                                            data-admin-remarks="{{ a.admin_remarks|default:'N/A' }}"
                                                               data-from-date="{{ a.from_date }}"
                                                               data-to-date="{{ a.to_date }}"
                                                               data-date-applied="{{ r.posting_date }}"

                                                               data-employee="{{ a.employee }}"
                                                            data-bs-toggle="modal" data-bs-target="#staticBackdrop" href="#">View</a>
                                                        </td>
                                                    </tr>
                                                {% endfor %}
                                            {% else %}
                                                <tr>
                                                    <td colspan="8">No leave applications found.</td>
                                                </tr>
                                            {% endif %}

                                            </tbody>
                                        </table>
                                    </div>
                                    <!--//table-responsive-->

                                </div>
                                <!--//app-card-body-->
                            </div>
                            <!--//app-card-->
                            <nav class="app-pagination">
                                <ul class="pagination justify-content-center">
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
                                    </li>
                                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                                    <li class="page-item">
                                        <a class="page-link" href="#">Next</a>
                                    </li>
                                </ul>
                            </nav>
                            <!--//app-pagination-->

                        </div>
                        <!--//tab-pane-->

                        <div class="tab-pane fade" id="orders-paid" role="tabpanel" aria-labelledby="orders-paid-tab">
                            <div class="app-card app-card-orders-table mb-5">
                                <div class="app-card-body">
                                    <div class="table-responsive">

                                        <table class="table mb-0 text-left">
                                            <thead>
                                            <tr>
                                                <th class="cell">s/no</th>
                                                <th class="cell">Emp/Name</th>
                                                <th class="cell">Department</th>
                                                <th class="cell">Apply/Date</th>
                                                <th class="cell">Status</th>
                                                <th class="cell">Days Applied</th>
                                                <th class="cell"></th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% if approved %}
                                                {% for a in approved %}
                                                    <tr>
                                                        <td class="cell">{{ forloop.counter }}</td>
                                                        <td class="cell"><span class="truncate">{{ a.employee }}</span>
                                                        </td>
                                                        <td class="cell">{{ a.employee.designation }}</td>
                                                        <td class="cell"><span>{{ a.posting_date }}</span></td>
                                                        <td class="cell"><span
                                                                class="badge bg-success">{{ a.status }}</span></td>
                                                        <td class="cell">{{ a.no_of_days }}</td>
                                                        <td class="cell">
                                                            <a class="btn-sm app-btn-secondary" data-id="{{a.id}}"
                                                            data-admin-remarks="{{ a.admin_remarks|default:'N/A' }}"
                                                               data-from-date="{{ a.from_date }}"
                                                               data-to-date="{{ a.to_date }}"
                                                               data-date-applied="{{ a.posting_date }}"
                                                               data-status="{{ a.status }}"
                                                               data-employee="{{ a.employee }}"
                                                            data-bs-toggle="modal" data-bs-target="#staticBackdrop" href="#">View</a>
                                                        </td>
                                                    </tr>
                                                {% endfor %}
                                            {% else %}
                                                <tr>
                                                    <td colspan="8">No leave applications found.</td>
                                                </tr>
                                            {% endif %}


                                            </tbody>
                                        </table>
                                    </div>
                                    <!--//table-responsive-->
                                </div>
                                <!--//app-card-body-->
                            </div>
                            <!--//app-card-->
                        </div>
                        <!--//tab-pane-->


                        <div class="tab-pane fade" id="orders-cancelled" role="tabpanel"
                             aria-labelledby="orders-cancelled-tab">
                            <div class="app-card app-card-orders-table mb-5">
                                <div class="app-card-body">
                                    <div class="table-responsive">
                                        <table class="table mb-0 text-left">
                                            <thead>
                                            <tr>
                                                <th class="cell">s/no</th>
                                                <th class="cell">Emp/Name</th>
                                                <th class="cell">Department</th>
                                                <th class="cell">Apply/Date</th>
                                                <th class="cell">Status</th>
                                                <th class="cell">Total/Emp</th>
                                                <th class="cell"></th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% if rejected %}
                                                {% for r in rejected %}

                                                    <tr>
                                                        <td class="cell">{{ forloop.counter }}</td>
                                                        <td class="cell"><span class="truncate">{{ r.employee }}</span>
                                                        </td>
                                                        <td class="cell"><span
                                                                class="truncate">{{ r.employee.designation }}</span>
                                                        </td>
                                                        <td class="cell"><span>{{ r.posting_date  }}</span>
                                                        </td>
                                                        <td class="cell"><span
                                                                class="badge bg-danger">{{ r.status }}</span></td>
                                                        <td class="cell">
                                                            <a class="btn-sm app-btn-secondary" data-id="{{r.id}}"
                                                            data-admin-remarks="{{ r.admin_remarks|default:'N/A' }}"
                                                               
                                                               data-from-date="{{ r.from_date }}"
                                                               data-to-date="{{ r.to_date }}"
                                                               data-date-applied="{{ r.posting_date }}"
                                                               data-status="{{ r.status }}"
                                                               data-employee="{{ r.employee }}"
                                                            data-bs-toggle="modal" data-bs-target="#staticBackdrop" href="#">View</a>
                                                        </td>
                                                    </tr>
                                                {% endfor %}
                                            {% else %}
                                                <tr>
                                                    <td colspan="8">No leave applications found.</td>
                                                </tr>
                                            {% endif %}

                                            </tbody>
                                        </table>
                                    </div>
                                    <!--//table-responsive-->
                                </div>
                                <!--//app-card-body-->
                            </div>
                            <!--//app-card-->
                        </div>
                        <!--//tab-pane-->
                    </div>
                    <!--//tab-content-->


                </div>
                <!--//container-fluid-->

            </div>
            <!--//container-fluid-->
        </div>
        <!--//app-content-->
        <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
     aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="updateLeaveModalLabel">Update Leave Application</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="post" action="">
                {% csrf_token %}
                <div class="modal-body">
                    <!-- Employee Name -->
                    <div class="mb-3">
                        <label for="employeeName" class="form-label"><strong>Employee Name:</strong></label>
                        <input type="text" class="form-control" id="employee" readonly>
                    </div>
                    <!-- Date Applied -->
                    <div class="mb-3">
                        <label for="postingDate" class="form-label"><strong>Date Applied:</strong></label>
                        <input type="text" class="form-control" id="dateapplied" readonly>
                    </div>
                    <!-- From Date -->
                    <div class="mb-3">
                        <label for="fromDate" class="form-label"><strong>From Date:</strong></label>
                        <input type="text" class="form-control" id="fromdate" readonly>
                    </div>
                    <!-- To Date -->
                    <div class="mb-3">
                        <label for="toDate" class="form-label"><strong>To Date:</strong></label>
                        <input type="text" class="form-control" id="todate" readonly>
                    </div>
                    <!-- Status -->
                    <div class="mb-3">
                        <label for="status" class="form-label">Status</label>
                        <select class="form-select" name="status" id="status" required>
                            <option value="Pending">Pending</option>
                            <option value="Approved">Approved</option>
                            <option value="Rejected">Rejected</option>
                            <option value="Cancelled">Cancelled</option>
                        </select>
                    </div>
                    <!-- Admin Remarks -->
                    <div class="mb-3">
                        <label for="adminRemarks" class="form-label">Admin Remarks</label>
                        <textarea class="form-control" name="admin_remarks" id="adminRemarks" rows="3" required></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Apply Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>


        <footer class="app-footer">
            <div class="container text-center py-3">

                <small class="copyright">Designed with <span class="sr-only">love</span><i class="fas fa-heart"
                                                                                           style="color: #fb866a;"></i>
                    by <a class="app-link" href=""
                          target="_blank">Nandi Dev</a> For Huduma</small>

            </div>
        </footer>
        <!--//app-footer-->

    </div>
    <!--//app-wrapper-->

       <script>
    const staticBackdropModal = document.getElementById('staticBackdrop');

    staticBackdropModal.addEventListener('show.bs.modal', function (event) {
        const button = event.relatedTarget;
        const leaveId = button.getAttribute('data-id');
        const adminRemarks = button.getAttribute('data-admin-remarks');
        const employee = button.getAttribute('data-employee');
        const from_date = button.getAttribute('data-from-date');
        const to_date = button.getAttribute('data-to-date');
        const date_applied = button.getAttribute('data-date-applied');
        const status = button.getAttribute('data-status');

        document.getElementById('adminRemarks').value = adminRemarks;
        document.getElementById('employee').value = employee;
        document.getElementById('fromdate').value = from_date;
        document.getElementById('todate').value = to_date;
        document.getElementById('dateapplied').value = date_applied;
        document.getElementById('status').value = status;

        const form = staticBackdropModal.querySelector('form');
        form.action = `/accounts/updateda/${leaveId}/`;
         // Set the status field to be read-only if the current status is not "Pending"
        const statusField = document.getElementById('status');
        if (status !== 'Pending') {
            statusField.setAttribute('disabled', 'disabled');
        } else {
            statusField.removeAttribute('disabled');
        }
    });
        // Enable the status field before form submission if it was disabled
    staticBackdropModal.querySelector('form').addEventListener('submit', function () {
        const statusField = document.getElementById('status');
        if (statusField.hasAttribute('disabled')) {
            statusField.removeAttribute('disabled');
        }
    });
</script>

{% endblock %}
{% block title %}Home{% endblock %}